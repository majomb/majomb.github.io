import*as e from"https://unpkg.com/three@0.126.1/build/three.module.js";import*as t from"https://unpkg.com/three@0.126.1/examples/jsm/libs/dat.gui.module.js";import o from"https://unpkg.com/three@0.126.1/examples/jsm/libs/stats.module.js";import{OrbitControls as n}from"https://unpkg.com/three@0.126.1/examples/jsm/controls/OrbitControls.js";import{EffectComposer as r}from"https://unpkg.com/three@0.126.1/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as i}from"https://unpkg.com/three@0.126.1/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as s}from"https://unpkg.com/three@0.126.1/examples/jsm/postprocessing/UnrealBloomPass";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,i)=>{const s=new URL(e,n);if(self[t].moduleMap[s])return o(self[t].moduleMap[s]);const a=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){i(new Error(`Failed to import: ${e}`)),r(l)},onload(){o(self[t].moduleMap[s]),r(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/assets/");function a(e){function t(e,t,o){this.x=e,this.y=t,this.z=o}t.prototype.dot2=function(e,t){return this.x*e+this.y*t},t.prototype.dot3=function(e,t,o){return this.x*e+this.y*t+this.z*o},this.grad3=[new t(1,1,0),new t(-1,1,0),new t(1,-1,0),new t(-1,-1,0),new t(1,0,1),new t(-1,0,1),new t(1,0,-1),new t(-1,0,-1),new t(0,1,1),new t(0,-1,1),new t(0,1,-1),new t(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(e||0)}a.prototype.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=this.p,o=0;o<256;o++){var n;n=1&o?t[o]^255&e:t[o]^e>>8&255;var r=this.perm,i=this.gradP;r[o]=r[o+256]=n,i[o]=i[o+256]=this.grad3[n%12]}};var l=.5*(Math.sqrt(3)-1),p=(3-Math.sqrt(3))/6,d=1/6;function m(e){return e*e*e*(e*(6*e-15)+10)}function u(e,t,o){return(1-o)*e+o*t}let c,h,v,f,w,g,x,y,b,M,C;function P(){f.width=window.innerWidth,f.height=window.innerHeight,h.aspect=f.aspect,h.updateProjectionMatrix(),v.setSize(f.width,f.height),v.setPixelRatio(f.pixelRatio),C.setSize(f.width,f.height)}a.prototype.simplex2=function(e,t){var o,n,r=(e+t)*l,i=Math.floor(e+r),s=Math.floor(t+r),a=(i+s)*p,d=e-i+a,m=t-s+a;d>m?(o=1,n=0):(o=0,n=1);var u=d-o+p,c=m-n+p,h=d-1+2*p,v=m-1+2*p;i&=255,s&=255;var f=this.perm,w=this.gradP,g=w[i+f[s]],x=w[i+o+f[s+n]],y=w[i+1+f[s+1]],b=.5-d*d-m*m,M=.5-u*u-c*c,C=.5-h*h-v*v;return 70*((b<0?0:(b*=b)*b*g.dot2(d,m))+(M<0?0:(M*=M)*M*x.dot2(u,c))+(C<0?0:(C*=C)*C*y.dot2(h,v)))},a.prototype.simplex3=function(e,t,o){var n,r,i,s,a,l,p=.3333333333333333*(e+t+o),m=Math.floor(e+p),u=Math.floor(t+p),c=Math.floor(o+p),h=(m+u+c)*d,v=e-m+h,f=t-u+h,w=o-c+h;v>=f?f>=w?(n=1,r=0,i=0,s=1,a=1,l=0):v>=w?(n=1,r=0,i=0,s=1,a=0,l=1):(n=0,r=0,i=1,s=1,a=0,l=1):f<w?(n=0,r=0,i=1,s=0,a=1,l=1):v<w?(n=0,r=1,i=0,s=0,a=1,l=1):(n=0,r=1,i=0,s=1,a=1,l=0);var g=v-n+d,x=f-r+d,y=w-i+d,b=v-s+2*d,M=f-a+2*d,C=w-l+2*d,P=v-1+.5,j=f-1+.5,S=w-1+.5;m&=255,u&=255,c&=255;var R=this.perm,F=this.gradP,z=F[m+R[u+R[c]]],q=F[m+n+R[u+r+R[c+i]]],E=F[m+s+R[u+a+R[c+l]]],k=F[m+1+R[u+1+R[c+1]]],V=.5-v*v-f*f-w*w,L=.5-g*g-x*x-y*y,T=.5-b*b-M*M-C*C,U=.5-P*P-j*j-S*S;return 32*((V<0?0:(V*=V)*V*z.dot3(v,f,w))+(L<0?0:(L*=L)*L*q.dot3(g,x,y))+(T<0?0:(T*=T)*T*E.dot3(b,M,C))+(U<0?0:(U*=U)*U*k.dot3(P,j,S)))},a.prototype.perlin2=function(e,t){var o=Math.floor(e),n=Math.floor(t);e-=o,t-=n,o&=255,n&=255;var r=this.perm,i=this.gradP,s=i[o+r[n]].dot2(e,t),a=i[o+r[n+1]].dot2(e,t-1),l=i[o+1+r[n]].dot2(e-1,t),p=i[o+1+r[n+1]].dot2(e-1,t-1),d=m(e);return u(u(s,l,d),u(a,p,d),m(t))},a.prototype.perlin3=function(e,t,o){var n=Math.floor(e),r=Math.floor(t),i=Math.floor(o);e-=n,t-=r,o-=i,n&=255,r&=255,i&=255;var s=this.perm,a=this.gradP,l=a[n+s[r+s[i]]].dot3(e,t,o),p=a[n+s[r+s[i+1]]].dot3(e,t,o-1),d=a[n+s[r+1+s[i]]].dot3(e,t-1,o),c=a[n+s[r+1+s[i+1]]].dot3(e,t-1,o-1),h=a[n+1+s[r+s[i]]].dot3(e-1,t,o),v=a[n+1+s[r+s[i+1]]].dot3(e-1,t,o-1),f=a[n+1+s[r+1+s[i]]].dot3(e-1,t-1,o),w=a[n+1+s[r+1+s[i+1]]].dot3(e-1,t-1,o-1),g=m(e),x=m(t),y=m(o);return u(u(u(l,h,g),u(p,v,g),y),u(u(d,f,g),u(c,w,g),y),x)};const j=new e.Clock,S=new a(Math.random());function R(){M.begin(),w.update();const e=j.getElapsedTime();x.uniforms.uTime.value=e,g.update(v,c);const t=.1*e,o=S.perlin2(t,t+100),n=S.perlin2(t+100,t+1e3),r=S.perlin2(t+1e4,t+1e5);y.position.x=.2*o,y.position.y=.2*n,y.position.z=.2*r,C.render(),requestAnimationFrame(R),M.end()}!function(){const a=new t.GUI({width:300});M=new o,M.showPanel(0),document.body.appendChild(M.dom),f={width:window.innerWidth,height:window.innerHeight,get aspect(){return this.width/this.height},get pixelRatio(){return Math.min(window.devicePixelRatio,2)}},c=new e.Scene;const l=(new e.CubeTextureLoader).load(["https://closure.vps.wbsprt.com/files/spherecolorful/bg3/px.jpg","https://closure.vps.wbsprt.com/files/spherecolorful/bg3/nx.jpg","https://closure.vps.wbsprt.com/files/spherecolorful/bg3/py.jpg","https://closure.vps.wbsprt.com/files/spherecolorful/bg3/ny.jpg","https://closure.vps.wbsprt.com/files/spherecolorful/bg3/pz.jpg","https://closure.vps.wbsprt.com/files/spherecolorful/bg3/nz.jpg"]);c.background=l,h=new e.PerspectiveCamera(85,f.aspect,1,500),h.position.z=4,c.add(h),b=new e.Group;const p=new e.WebGLCubeRenderTarget(256,{format:e.RGBFormat,generateMipmaps:!1,minFilter:e.LinearFilter});g=new e.CubeCamera(1,100,p),b.add(g);const d=new e.SphereBufferGeometry(2,500,500);x=new e.ShaderMaterial({uniforms:{uTime:{value:0},uElevation:{value:.2},uFrequency:{value:15},uSpeed:{value:1},uCubeMap:{value:g.renderTarget.texture}},vertexShader:"\n      uniform float uTime;\n      uniform float uElevation;\n      uniform float uFrequency;\n      uniform float uSpeed;\n\n      varying vec2 vUv;\n      varying vec3 vViewVector;\n      varying vec3 vNormal;\n      varying float vColorScale;\n\n      void main() {\n\n        float timeSpeed = uTime * uSpeed;\n        float elevationScale = uElevation * sin(position.x * uFrequency + timeSpeed) * sin(position.y * uFrequency + timeSpeed) * sin(position.z * uFrequency + timeSpeed);\n\n        float elevationValue = smoothstep(-uElevation, uElevation, elevationScale);\n\n        float shiftFreq = uFrequency * 0.5;\n\n        float sideShift = sin(position.y * shiftFreq + uTime) * sin(position.z * shiftFreq + uTime) * uElevation * 0.8;\n\n        vec3 elevationVector = (normalize(normal) * elevationScale) + vec3(sideShift, 0, 0);\n\n        vec4 modelPosition = modelMatrix * vec4(position + elevationVector, 1.0);\n\n        vec4 viewPosition = viewMatrix * modelPosition;\n        vec4 projectedPosition = projectionMatrix * viewPosition;\n\n        vViewVector = modelPosition.xyz - cameraPosition;\n        vNormal = normal;\n        vColorScale = elevationValue;\n\n        gl_Position = projectedPosition;\n      }\n    ",fragmentShader:"\n      uniform samplerCube uCubeMap;\n\n      varying vec3 vViewVector;\n      varying vec3 vNormal;\n      varying float vColorScale;\n\n      void main() {\n        vec3 reflectedDirection = normalize(reflect(vViewVector, vNormal));\n        reflectedDirection.x = -reflectedDirection.x;\n\n        vec3 textureColor = textureCube(uCubeMap, reflectedDirection).rgb;\n\n\n        vec3 darkestColor = textureColor * vec3(0.1);\n        vec3 lightestColor = textureColor * vec3(1.9);\n\n        vec3 color = mix(darkestColor, lightestColor, vColorScale);\n\n        gl_FragColor = vec4(color, 1.0);\n      }\n    "}),a.add(x.uniforms.uElevation,"value").min(0).max(2).step(.001).name("elevation"),a.add(x.uniforms.uFrequency,"value").min(0).max(100).step(.001).name("frequency"),a.add(x.uniforms.uSpeed,"value").min(0).max(20).step(.001).name("speed"),y=new e.Mesh(d,x),y.scale.set(1,1,1),b.add(y),c.add(b),v=new e.WebGLRenderer({antialias:f.pixelRatio<1.5}),v.setSize(f.width,f.height),v.setPixelRatio(f.pixelRatio),document.body.appendChild(v.domElement),C=new r(v),C.setPixelRatio(f.pixelRatio),C.setSize(f.width,f.height);const m=new i(c,h);C.addPass(m);const u=new s;C.addPass(u),u.strength=.4,u.radius=1,u.threshold=.6;var j=a.addFolder("Bloom");j.add(u,"enabled"),j.add(u,"strength").min(0).max(2).step(.001),j.add(u,"radius").min(0).max(2).step(.001),j.add(u,"threshold").min(0).max(1).step(.001),w=new n(h,v.domElement),w.enableDamping=!0,window.addEventListener("resize",P),R()}();
